<template>
  <div class="navbar bg-base-100 shadow-sm">
    <div class="flex-1">
      <div class="breadcrumbs text-sm">
        <ul>
          <li><a>Texts</a></li>
          <li>{{ textStore.text.name }} ({{ textStore.text.author?.name }})</li>
        </ul>
      </div>
    </div>
    <div class="flex-none">
      <ul class="menu menu-horizontal px-1">
        <li>
          <details>
            <summary>Elements</summary>
            <ul class="bg-base-100 rounded-t-none p-2">
              <li v-for="source in textStore.sources" :key="source.id">
                <a @click="generateBlocks(source.id)">
                  Auto generate text blocks:
                  {{ source.text_type }}
                </a>
              </li>
              <li><a>Create annotation</a></li>
            </ul>
          </details>
        </li>
        <li>
          <details>
            <summary>Display</summary>
            <ul class="bg-base-100 rounded-t-none p-2">
              TODO add display options
              <li><a>Link 1</a></li>
              <li><a>Link 2</a></li>
            </ul>
          </details>
        </li>
      </ul>
    </div>
  </div>
  <div v-if="textStore.text">
    <annotate-text :storeId="storeId" />
  </div>
  <div class="toast toast-center" v-if="generatedBlocks">
    <div role="alert" class="alert alert-success bg-white">
      <span>The autogenerated blocks are not saved</span>
      <div class="flex gap-2">
        <Btn :color="Color.secondary" @click="cancelGeneratedBlocks">Deny</Btn>
        <Btn @click="saveGeneratedBlocks">Save</Btn>
      </div>
    </div>
  </div>
</template>
<script setup lang="ts">
import { useTextStore } from './text.store';
import AnnotateText from './controls/annotate-text/annotate-text.vue';
import { useAnnotationStore } from './controls/annotate-text/utils/annotation.store';
import { effect, ref } from 'vue';
import { Btn, Color } from '@ghentcdh/ui';

const textStore = useTextStore();
const storeId = 'identify_and_translate' + Date.now();

const annotationStore = useAnnotationStore(storeId)();
const generatedBlocks = ref(false);

effect(() => {
  console.log(textStore.text);
  if (!textStore.text) return;
  annotationStore.init(textStore.sources, textStore.textId);
});

const generateBlocks = (sourceId: string) => {
  annotationStore.autoGenerateBlocks(sourceId);
  generatedBlocks.value = true;
};

const saveGeneratedBlocks = () => {
  annotationStore.saveGeneratedBlocks();
  generatedBlocks.value = false;
};
const cancelGeneratedBlocks = () => {
  annotationStore.cancelGeneratedBLocks();
  generatedBlocks.value = false;
};
</script>
